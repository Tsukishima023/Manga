<!doctype html><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>欠陥品の記憶｜第1話</title>
<style>
  body{margin:0;background:#0b0f12;color:#eaf6ff;font-family:"Noto Serif JP","Yu Mincho",serif}
  main{max-width:1100px;margin:0 auto;padding:10px 12px 60px}
  img{display:block;width:100%;height:auto;margin:0 0 16px;background:#0f1419;border:1px solid #2a3138;border-radius:8px}
  header{position:sticky;top:0;background:#0d1319;border-bottom:1px solid #2a3138;padding:10px 12px}
  a{color:#9fc9ff;text-decoration:none}
</style>
<header><strong>欠陥品の記憶 — 第1話</strong>　
  <a href="/Manga/kekkan/">← 各話一覧へ</a>
</header>
<main id="v"><p>読み込み中…</p></main>
<script>
(async()=>{
  const base = location.href;                      // いまの /kekkan/01/ を基準に
  const man  = new URL('./manifest.json', base);   // 必ず同フォルダの manifest を見る
  const v    = document.getElementById('v');
  try{
    const r = await fetch(man.toString(), {cache:'no-store'});
    if(!r.ok) throw new Error('manifest '+r.status);
    const txt = await r.text();                    // BOM対策
    const files = JSON.parse(txt.replace(/^\uFEFF/, ''));
    v.innerHTML = '';
    for(const name of files){
      const url = new URL('./'+name, base).toString();  // 同フォルダの 画像名 をそのまま
      const img = document.createElement('img');
      img.loading='lazy'; img.decoding='async'; img.src = url + '?v=' + Date.now(); // キャッシュ回避
      v.appendChild(img);
    }
  }catch(e){
    v.innerHTML = '<p>読み込み失敗。/kekkan/01/ に index.html・manifest.json・画像が並んでいるか確認してね。</p><pre>'+e+'</pre>';
  }
})();
</script>
